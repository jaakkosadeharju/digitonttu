/*! For license information please see gameBundle.js.LICENSE.txt */
(()=>{"use strict";var t=function(){function t(t,e){var i=this;this.extensionVisible=5,this.extendTime=function(t){i.timeExtensions.push({seconds:t,time:new Date})},this.ctx=t,this.terrain=e,this.timeExtensions=[]}return t.prototype.draw=function(t){var e=this;if(this.terrain){this.ctx.font="100px Josefin Sans",this.ctx.fillStyle="#afa5",this.ctx.textAlign="center";var i=Math.max(0,t/1e3),n=Math.round(i).toFixed();this.ctx.fillText((" "+n+" s").replace(".",","),this.terrain.areaDimensions.width/2,this.terrain.areaDimensions.height/2),this.timeExtensions=this.timeExtensions.filter((function(t){return(new Date).getTime()<t.time.getTime()+1e3*e.extensionVisible})),this.timeExtensions.forEach((function(t,i){var n=(t.time.getTime()+1e3*e.extensionVisible-(new Date).getTime())/1e3;e.ctx.font="40px Josefin Sans",t.seconds>0?e.ctx.fillStyle="rgba(30, 220, 30, "+n/e.extensionVisible+")":e.ctx.fillStyle="rgba(220, 30, 30, "+n/e.extensionVisible+")",e.ctx.textAlign="center";var o=t.seconds.toFixed(1);e.ctx.fillText(((t.seconds>0?"+":"")+o+" s").replace(".",","),e.terrain.areaDimensions.width/2,e.terrain.areaDimensions.height/2+100*(1-n/e.extensionVisible))}))}},t}(),e=function(t,e){this.width=t,this.height=e},i=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.distanceTo=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},t}(),n=function(){function t(t,e,n){var o=this;void 0===n&&(n=new i(100,100)),this.gravityScale=30,this.skiWidth=30,this.playerHeight=20,this.gravity=9.81*this.gravityScale,this.divingWeight=3,this.friction=.9,this.onScreenX=function(){return(o.terrain.areaDimensions.width+o.position.x)%o.terrain.areaDimensions.width},this.longestJump=function(){return Math.round(o.jumps.sort((function(t,e){return e-t}))[0]||0)},this.highestPoint=function(){return Math.round((o.terrain.areaDimensions.height-o.minY)/50)},this.topSpeed=function(){return Math.round(o.maxSpeed/50*3.6)},this.ski=function(){return{back:new i(o.position.x-o.skiWidth/2*Math.cos(o.angle),o.position.y-o.skiWidth/2*Math.sin(o.angle)),front:new i(o.position.x+o.skiWidth/2*Math.cos(o.angle),o.position.y+o.skiWidth/2*Math.sin(o.angle))}},this.velocityAngle=function(){var t=o.positionHistory[o.positionHistory.length-1],e=o.positionHistory[o.positionHistory.length-2];return t&&e?Math.atan2(e.y-t.y,e.x-t.x):0},this.calculateFrame=function(t,e){if(0!==t){o.positionHistory.push(new i(o.position.x,o.position.y)),o.positionHistory.splice(0,Math.max(0,o.positionHistory.length-1e3));var n=o.positionHistory[o.positionHistory.length-5]||o.position,s=o.terrain.getHeightAt(o.onScreenX()),a=s[0],r=s[1];if(o.diving&&a-20<=o.position.y&&(o.velocity.y+=10/(1e3*t)*Math.sin(r),o.velocity.x+=10/(1e3*t)*Math.cos(-r)),a-1<=o.position.y){o.jumpStartPos&&!o.onGround&&o.position.x-o.jumpStartPos>500&&o.jumps.push((o.position.x-o.jumpStartPos)/50),o.onGround=!0;var h=Math.sqrt(Math.pow(o.velocity.x,2)+Math.pow(o.velocity.y,2));o.velocity.x+=Math.sin(r)*(t*o.gravity),Math.abs(r-o.angle)>Math.PI/4&&(h=Math.min(h,100)),((r<o.angle||0==o.angle)&&o.velocity.x>=0||r>=o.angle&&o.velocity.x<0)&&(o.velocity.y=h*Math.sin(r),o.velocity.x=h*Math.cos(-r)),o.angle=r,o.position.y=Math.min(a,o.position.y),o.atGround=!0}else o.onGround&&(o.jumpStartPos=o.position.x),o.onGround=!1,o.velocity.y+=t*o.gravity*(o.diving?o.divingWeight:1),a-5<=o.position.y&&(o.atGround=!1);o.position.x+=t*o.velocity.x,o.position.y+=t*o.velocity.y,o.position.y<o.minY&&(o.minY=o.position.y),o.maxSpeed=Math.max(o.maxSpeed,Math.sqrt(Math.pow(o.velocity.x,2)+Math.pow(o.velocity.y,2))),a-10>o.position.y&&o.position.distanceTo(n)<o.terrain.areaDimensions.width/2&&(o.angle=Math.atan2(o.position.y-n.y,o.position.x-n.x))}},this.handleDiveButtonPress=function(){o.divePressed=!0,o.diving=!0,o.divePressed=!0},this.hanldeDiveButtonRelease=function(){o.divePressed&&(o.diving=!1,o.divePressed=!1)},this.canvas=t,this.ctx=t.getContext("2d"),this.terrain=e,this.position=n,this.angle=0,this.velocity=new i(10,10),this.positionHistory=[],this.atGround=!1,this.diving=!1,this.divePressed=!1,this.onGround=!1,this.jumps=[],this.minY=this.terrain.areaDimensions.height,this.maxSpeed=0,this.addEventListeners()}return t.prototype.drawImage=function(t,e,i,n,o){this.ctx.setTransform(n,0,0,n,e,i),this.ctx.rotate(o),this.ctx.drawImage(t,-t.width/2,-t.height/2)},t.prototype.drawImageCenter=function(t,e,i,n,o,s,a){this.ctx.setTransform(s,0,0,s,e,i),this.ctx.rotate(a),this.ctx.drawImage(t,-n,-o),this.ctx.setTransform(1,0,0,1,0,0)},t.prototype.draw=function(t){var e,i=this;this.position.y<-this.playerHeight&&(this.ctx.strokeStyle="#fff",this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.moveTo(this.onScreenX(),0),this.ctx.lineTo(this.onScreenX(),40),this.ctx.stroke(),this.ctx.textAlign="left",this.ctx.font="30px Josefin Sans",this.ctx.fillStyle="#dddddd99",this.ctx.fillText(Math.round((this.terrain.areaDimensions.height-this.position.y)/50)+" m",30,50)),this.velocity.x>=0?(e=document.getElementById("player"),this.drawImageCenter(e,this.onScreenX(),this.position.y,150,250,.2,this.angle)):(e=document.getElementById("player-reversed"),this.drawImageCenter(e,this.onScreenX(),this.position.y,150,250,.2,this.angle)),t.slice(0,20).forEach((function(t,e){var n=i.positionHistory[i.positionHistory.length-10*(e+1)];t.position.x=n.x%i.terrain.areaDimensions.width-t.width/2,t.position.y=n.y-t.height/2})),t.slice(20).forEach((function(t){return t.visible=!1}))},t.prototype.addEventListeners=function(){var t=this;window.addEventListener("keydown",(function(e){"Space"==e.code&&(e.preventDefault(),document.getElementById("dive").classList.add("active"),t.diving=!0)}),!1),window.addEventListener("keyup",(function(e){"Space"==e.code&&(e.preventDefault(),document.getElementById("dive").classList.remove("active"),t.diving=!1)}),!1)},t}(),o=function(){function t(t,e){this.width=43.5,this.height=42,this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.collected=!1,this.position=new i(Math.random()*(e.areaDimensions.width-this.width),Math.random()*(e.areaDimensions.height/2-this.height)),this.visible=!0}return t.prototype.draw=function(){if(!this.visible)return!1;var t=this.ctx,e=document.getElementById("present");t.drawImage(e,this.position.x-this.width/2,this.position.y-this.height/2,this.width,this.height)},t}(),s=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var s=arguments[e],a=0,r=s.length;a<r;a++,o++)n[o]=s[a];return n},a=function(){function t(t,e){var n=this;this.handleRadius=20,this.handleStrokeWidth=3,this.maxVerticalHeight=function(){return.7*n.areaDimensions.height},this.minVerticalHeight=function(){return.85*n.areaDimensions.height},this.startDrag=function(t,e,o){if(void 0===o&&(o=0),!n.draggingHandles[o]){var s=new i((t-n.canvas.offsetLeft)/n.canvas.offsetWidth*n.canvas.width,(e-n.canvas.offsetTop)/n.canvas.offsetHeight*n.canvas.height),a=n.points.reduce((function(t,e){return e.distanceTo(s)<t.distanceTo(s)?e:t}),new i(1/0,1/0));a.distanceTo(s)<2*n.handleRadius&&(n.draggingHandles[o]=a)}},this.moveTerrainHandle=function(t,e,o){if(void 0===o&&(o=0),n.draggingHandles[o]){var s=new i((t-n.canvas.offsetLeft)/n.canvas.offsetWidth*n.canvas.width,(e-n.canvas.offsetTop)/n.canvas.offsetHeight*n.canvas.height);n.draggingHandles[o].x=s.x,n.draggingHandles[o].y=Math.max(Math.min(s.y,n.minVerticalHeight()),n.maxVerticalHeight())}},this.endDrag=function(t){void 0===t&&(t=0),void 0!==n.draggingHandles[t]&&(n.draggingHandles[t]=void 0)},this.resetPoints=function(){n.points=[new i(n.areaDimensions.width-n.areaDimensions.width*(1/4),n.maxVerticalHeight()),new i(n.areaDimensions.width-n.areaDimensions.width*(3/4),n.minVerticalHeight())]},this.areaDimensions=e,this.canvas=t,this.resetPoints(),this.draggingHandles={},this.addMouseEventListeners()}return t.prototype.draw=function(){var t=this,e=this.canvas.getContext("2d");this.points=this.points.sort((function(t,e){return t.x-e.x}));var i=this.pointsWithControlPoints(),n=e.createLinearGradient(0,this.minVerticalHeight(),0,this.maxVerticalHeight());n.addColorStop(0,"#555"),n.addColorStop(.9,"#222"),e.fillStyle=n,e.beginPath(),e.moveTo(-this.areaDimensions.width,2*this.areaDimensions.height),e.lineTo(i[0].x,i[0].y),i.slice(1,i.length).forEach((function(t){return e.bezierCurveTo(t.cp1.x,t.cp1.y,t.cp2.x,t.cp2.y,t.x,t.y)})),e.lineTo(2*this.areaDimensions.width,2*this.areaDimensions.height),e.closePath(),e.fill(),this.points.forEach((function(i){e.beginPath(),e.arc(i.x,i.y,t.handleRadius,0,2*Math.PI),e.fillStyle="#dddddd99",e.fill(),e.beginPath(),e.arc(i.x,i.y,t.handleRadius,0,2*Math.PI),e.strokeStyle="#aaaaaaff",e.lineWidth=t.handleStrokeWidth,e.stroke()}))},t.prototype.getBezierXY=function(t,e,i){return{x:Math.pow(1-t,3)*e.x+3*t*Math.pow(1-t,2)*i.cp1.x+3*t*t*(1-t)*i.cp2.x+t*t*t*i.x,y:Math.pow(1-t,3)*e.y+3*t*Math.pow(1-t,2)*i.cp1.y+3*t*t*(1-t)*i.cp2.y+t*t*t*i.y}},t.prototype.getBezierAngle=function(t,e,i){var n=Math.pow(1-t,2)*(i.cp1.x-e.x)+2*t*(1-t)*(i.cp2.x-i.cp1.x)+t*t*(i.x-i.cp2.x),o=Math.pow(1-t,2)*(i.cp1.y-e.y)+2*t*(1-t)*(i.cp2.y-i.cp1.y)+t*t*(i.y-i.cp2.y);return-Math.atan2(n,o)+.5*Math.PI},t.prototype.getHeightAt=function(t){var e,i,n=this.pointsWithControlPoints().sort((function(t,e){return t.x-e.x}));(t<0||t>this.areaDimensions.width)&&console.error("Cannot resolve terrain height at "+t);for(var o=0;o<n.length;o++)if(n[o].x>t){i=n[o],e=n[o-1];break}var s=1;for(o=1;o<=100;++o)this.getBezierXY(s,e,i).x<t?s+=.5/o:s-=.5/o;return[this.getBezierXY(s,e,i).y,this.getBezierAngle(s,e,i)]},t.prototype.extrapolatedPoints=function(){var t=this.points;return s([{x:t[t.length-1].x-this.areaDimensions.width,y:t[t.length-1].y}],t,[{x:this.areaDimensions.width+t[0].x,y:t[0].y}])},t.prototype.pointsWithControlPoints=function(){return this.extrapolatedPoints().reduce((function(t,e,i,n){var o=n[(n.length+i-1)%n.length].x;return s(t,[{x:e.x,y:e.y,cp1:{x:o+(e.x-o)/2,y:n[(n.length+i-1)%n.length].y},cp2:{x:e.x-(e.x-o)/2,y:e.y}}])}),[])},t.prototype.addMouseEventListeners=function(){var t=this;this.canvas.addEventListener("mousedown",(function(e){e.preventDefault(),t.startDrag(e.clientX,e.clientY)}),!1),this.canvas.addEventListener("mousemove",(function(e){e.preventDefault(),t.moveTerrainHandle(e.clientX,e.clientY)}),!1),this.canvas.addEventListener("mouseup",(function(e){e.preventDefault(),t.endDrag()}),!1),this.canvas.addEventListener("touchstart",(function(e){e.preventDefault();for(var i=0;i<e.touches.length;i++){var n=e.targetTouches.item(i);n&&t.startDrag(n.clientX,n.clientY,n.identifier)}}),!1),this.canvas.addEventListener("touchend",(function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++){var n=e.changedTouches.item(i);t.endDrag(n.identifier)}}),!1),this.canvas.addEventListener("touchcancel",(function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++){var n=e.changedTouches.item(i);t.endDrag(n.identifier)}}),!1),this.canvas.addEventListener("touchmove",(function(e){e.preventDefault();for(var i=0;i<e.changedTouches.length;i++){var n=e.changedTouches.item(i);t.moveTerrainHandle(n.clientX,n.clientY,n.identifier)}}),!1)},t}(),r=document.getElementById("game-area"),h=r.getContext("2d");r.height=window.innerHeight,r.width=window.innerWidth;var d,c,l,u,g,m,p=r.height,f=r.width,v=0,y=JSON.parse(localStorage.getItem("highscore"))||0,x=JSON.parse(localStorage.getItem("stats"))||{longestJump:0,highestPoint:0,gamesPlayed:0,topSpeed:0},w=new function(){var t=this;this.mainVolume=.15,this.gameVolume=.15,this.fxVolume=1,this.startGameTune=function(){t.gameTune&&t.stopGameTune(),t.gameTune=new Audio("/audio/sleighride.mp3"),t.gameTune.loop=!0,t.gameTune.volume=t.enabled?t.gameVolume:0,t.gameTune.play()},this.stopGameTune=function(){t.stopTune(t.gameTune)},this.startMainTune=function(){t.mainTune&&t.stopMainTune(),t.mainTune=new Audio("/audio/Rush%20Coil%20-%208-bit%20Christmas/Rush%20Coil%20-%208-bit%20Christmas%20-%2012%20Auld%20Lang%20Syne.mp3"),t.mainTune.loop=!0,t.mainTune.volume=t.enabled?t.mainVolume:0,t.mainTune.play()},this.stopMainTune=function(){t.stopTune(t.mainTune)},this.stopTune=function(t){var e=setInterval((function(){t&&(t.volume-=Math.min(.01,t.volume),t.volume<=0&&(t.pause(),clearInterval(e)))}),100)},this.playCollectSound=function(){if(t.enabled){var e=new Audio("/audio/jingle.mp3");e.volume=t.fxVolume,e.play()}},this.toggleMute=function(){t.enabled=!t.enabled,localStorage.setItem("soundsEnabled",t.enabled?"true":"false"),t.mainTune&&(t.mainTune.volume=t.enabled?t.mainVolume:0),t.gameTune&&(t.gameTune.volume=t.enabled?t.gameVolume:0)},this.enabled=!1!==JSON.parse(localStorage.getItem("soundsEnabled"))},T=function(t){var e=t.createLinearGradient(0,0,0,p);e.addColorStop(0,"#474"),e.addColorStop(.5,"#333"),e.addColorStop(1,"#daa"),t.fillStyle=e,t.fillRect(0,0,f,p)},D=function(){r.height=window.innerHeight,r.width=window.innerWidth,p=r.height,f=r.width,d.areaDimensions.width=r.width,d.areaDimensions.height=r.height,d.resetPoints(),document.getElementsByTagName("body")[0].style.height=window.innerHeight+"px",T(h)},S=function(){T(h),d.draw(),h.font="50px Josefin Sans",h.textAlign="right",h.fillText(""+(l.length-1),f-40,60),h.font="14px Josefin Sans",h.textAlign="right",h.fillText("Pisin hyppy "+c.longestJump()+" m",f-40,100),h.fillText("Maksimikorkeus "+c.highestPoint()+" m",f-40,120),h.fillText("Huippunopeus "+c.topSpeed()+" km/h",f-40,140),g&&m.draw(1e3*(30+v)-(u.getTime()-g.getTime())),c.draw(l.filter((function(t){return t.collected}))),l.forEach((function(t,e){t.draw()}))},M=function(){document.getElementById("result").innerText=(l.length-1).toString(),document.getElementById("high-score").innerText=y.toString(),document.getElementById("games-played").innerText=x.gamesPlayed.toString(),document.getElementById("longest-jump").innerText=x.longestJump.toString(),document.getElementById("highest-point").innerText=x.highestPoint.toString(),document.getElementById("top-speed").innerText=x.topSpeed.toString()},E=function(){var t=document.getElementById("sound");w.enabled?(t.innerHTML="&#128266;",t.classList.remove("muted")):(t.innerHTML="&#128263;",t.classList.add("muted"))},H=function(){d=new a(r,new e(f,p)),m=new t(h,d),c=new n(r,d,new i(50,600)),l=[new o(r,d)],u=new Date,M(),E()},P=function(){h.clearRect(0,0,f,p);var t=l[l.length-1],e=c.skiWidth;if(new i(c.onScreenX(),c.position.y-e).distanceTo(t.position)<1.5*t.width){t.collected=!0,l.push(new o(r,d));var n=d.areaDimensions.width/c.velocity.x*(5*d.areaDimensions.height/d.areaDimensions.width)*((d.areaDimensions.width+d.areaDimensions.height)/5e3)-1;n=Math.min(10,n),v+=n,m.extendTime(n),w.playCollectSound()}if(S(),g.getTime()>(new Date).getTime()-1e3*(30+v))requestAnimationFrame(P);else{var s=l.length-1;document.getElementsByTagName("body")[0].classList.remove("started"),document.getElementById("result").innerText=s.toString(),w.stopGameTune(),y=Math.max(y,s),localStorage.setItem("highscore",JSON.stringify(y)),document.getElementById("high-score").innerText=s.toString(),x.gamesPlayed+=1,x.longestJump=Math.max(x.longestJump||0,c.longestJump()),x.highestPoint=Math.max(x.highestPoint||0,c.highestPoint()),x.topSpeed=Math.max(x.topSpeed||0,c.topSpeed()),localStorage.setItem("stats",JSON.stringify(x)),M()}};H(),D(),setTimeout((function(){S()}),200),window.onresize=D,window.onscroll=D,document.getElementById("start").onclick=function(){(function(){H(),g=new Date,v=0,u=g;var t=setInterval((function(){var e,i,n;g.getTime()>(new Date).getTime()-1e3*(30+v)?(e=u,(n=((i=new Date).getTime()-e.getTime())/1e3)>1e3&&(n=10),c.calculateFrame(n,l.filter((function(t){return t.collected}))),u=i):clearInterval(t)}),5);w.startGameTune()})(),document.getElementsByTagName("body")[0].classList.add("started"),requestAnimationFrame(P)};var I=document.getElementById("dive");I.addEventListener("mousedown",(function(t){c.handleDiveButtonPress()}),!1),I.addEventListener("mouseup",(function(t){c.hanldeDiveButtonRelease()}),!1),I.addEventListener("touchstart",(function(t){c.handleDiveButtonPress(),I.classList.add("active"),t.preventDefault()}),!1),I.addEventListener("touchend",(function(t){c.hanldeDiveButtonRelease(),I.classList.remove("active"),t.preventDefault()}),!1),I.addEventListener("touchcancel",(function(t){c.hanldeDiveButtonRelease(),I.classList.remove("active"),t.preventDefault()}),!1),document.getElementById("sound").addEventListener("click",(function(t){w.toggleMute(),E(),t.preventDefault()}),!1)})();
//# sourceMappingURL=gameBundle.js.map